name: ğŸ—ï¸ Build OTX Server - Release x64  
on:     
  push:    
    branches: [ main, develop ]    
  pull_request:    
    branches: [ main ]    
    
jobs:    
  build:    
    name: ğŸš€ Build Release x64  
    runs-on: windows-latest  
        
    steps:    
      - name: ğŸ“¥ Checkout Repository  
        uses: actions/checkout@v4    
            
      - name: ğŸ’¾ Cache Boost Libraries  
        uses: actions/cache@v4    
        id: cache-boost    
        with:    
          path: |    
            C:\ProgramData\chocolatey\lib\boost-msvc-14.3    
            C:\local\boost_1_84_0    
          key: boost-1.84.0-msvc-14.3-choco-${{ runner.os }}    
              
      - name: ğŸ« Install Boost via Chocolatey    
        if: steps.cache-boost.outputs.cache-hit != 'true'    
        run: |    
          Write-Host "ğŸ”½ Instalando Boost 1.84.0..." -ForegroundColor Yellow  
          choco install boost-msvc-14.3 --version=1.84.0 -y    
            
          Write-Host "ğŸ“ Configurando diretÃ³rios..." -ForegroundColor Cyan  
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }    
          if (!(Test-Path "C:\local\boost_1_84_0")) {    
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"    
          }    
          Write-Host "âœ… Boost configurado!" -ForegroundColor Green  
        shell: powershell    
            
      - name: âš™ï¸ Setup MSBuild    
        uses: microsoft/setup-msbuild@v2    
            
      - name: ğŸ” Verify Build Environment    
        run: |    
          Write-Host "ğŸ”§ === Build Environment Check ===" -ForegroundColor Cyan  
          Write-Host "ğŸ“¦ Boost Path: $(if (Test-Path 'C:\local\boost_1_84_0') { 'âœ… OK' } else { 'âŒ MISSING' })"    
          Write-Host "ğŸ“š Boost Libs: $(if (Test-Path 'C:\local\boost_1_84_0\lib64-msvc-14.3') { 'âœ… OK' } else { 'âŒ MISSING' })"    
          Write-Host "ğŸ› ï¸ MSBuild Version:" -ForegroundColor Cyan  
          msbuild -version    
          Write-Host "âœ¨ Environment ready!" -ForegroundColor Green  
        shell: powershell    
            
      - name: ğŸš€ Build OTX Server (Release x64)  
        run: |    
          Write-Host "ğŸ”¨ Compilando OTX Server em Release x64..." -ForegroundColor Yellow  
          msbuild sources/msvc/TheOTXServer.vcxproj /p:Configuration=Release /p:Platform=x64 /m /v:minimal /p:WarningLevel=1  
          Write-Host "ğŸ‰ CompilaÃ§Ã£o concluÃ­da!" -ForegroundColor Green  
        shell: powershell    
            
      - name: ğŸ“¦ Upload Release Artifacts  
        uses: actions/upload-artifact@v4    
        with:    
          name: ğŸ¯ OTXServer-Release-x64  
          path: |    
            sources/msvc/x64/Release/TheOTXServer.exe    
            sources/msvc/x64/Release/TheOTXServer.pdb    
          retention-days: 30
