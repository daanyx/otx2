name: ğŸš€ xBuild OTX Server      
on: [push, pull_request]      
      
jobs:      
  build:      
    runs-on: windows-latest      
    steps:      
      - name: ğŸ“¥ Checkout Code  
        uses: actions/checkout@v4      
            
      - name: ğŸ—‚ï¸ Cache Boost      
        uses: actions/cache@v4      
        id: cache-boost      
        with:      
          path: |      
            C:\ProgramData\chocolatey\lib\boost-msvc-14.3      
            C:\local\boost_1_84_0      
          key: boost-1.84.0-msvc-14.3-${{ runner.os }}      
              
      - name: ğŸ“¦ Install Boost     
        if: steps.cache-boost.outputs.cache-hit != 'true'      
        run: |      
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8  
          Write-Host "ğŸ”„ Installing Boost libraries..."  
          choco install boost-msvc-14.3 --version=1.84.0 -y      
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }      
          if (!(Test-Path "C:\local\boost_1_84_0")) {      
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"      
          }      
          Write-Host "âœ… Boost installation completed!"  
        shell: powershell      
            
      - name: ğŸ”— Create Boost Symlink      
        if: steps.cache-boost.outputs.cache-hit == 'true'      
        run: |      
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8  
          Write-Host "â™»ï¸ Using cached Boost libraries..."  
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }      
          if (!(Test-Path "C:\local\boost_1_84_0")) {      
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"      
          }      
          Write-Host "âœ… Boost symlink created!"  
        shell: powershell      
              
      - name: ğŸ’¾ Cache MSBuild Objects      
        uses: actions/cache@v4      
        with:      
          path: |      
            sources/msvc/x64      
            sources/msvc/*.tlog      
          key: msbuild-cache-${{ runner.os }}-${{ hashFiles('sources/**/*.cpp', 'sources/**/*.h') }}      
          restore-keys: |      
            msbuild-cache-${{ runner.os }}-      
                  
      - name: ğŸ”§ Setup MSBuild      
        uses: microsoft/setup-msbuild@v2      
              
      - name: ğŸ—ï¸ Build OTX Server      
        run: |  
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8  
          Write-Host "ğŸš€ Starting OTX Server compilation..."  
          msbuild sources/msvc/TheOTXServer.vcxproj /p:Configuration=Release /p:Platform=x64 /m  
          Write-Host "âœ… Build completed successfully!"  
        shell: powershell  
    
      - name: ğŸ“‹ Prepare Artifacts    
        run: |    
          echo ğŸ“¦ Preparing build artifacts...  
          mkdir artifact-staging    
          copy sources\msvc\x64\Release\*.exe artifact-staging\    
          echo âœ… Artifacts prepared!  
        shell: cmd    
              
      - name: â¬†ï¸ Upload Artifact      
        uses: actions/upload-artifact@v4      
        with:      
          name: ğŸ¯ otx-server-build      
          path: artifact-staging/  
  
      - name: ğŸ‰ Build Success Notification  
        if: success()  
        run: |  
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8  
          Write-Host "ğŸŠ SUCCESS! OTX Server build completed successfully!"  
          Write-Host "ğŸ“ Artifact: otx-server-build"  
          Write-Host "ğŸ”— Download your build from the Actions tab"  
        shell: powershell  
  
      - name: âŒ Build Failure Notification    
        if: failure()  
        run: |  
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8  
          Write-Host "ğŸ’¥ BUILD FAILED! Please check the logs above for errors."  
          Write-Host "ğŸ” Common issues: Missing dependencies, compilation errors"  
        shell: powershell
