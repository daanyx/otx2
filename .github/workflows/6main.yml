name: 🏗️ Build OTX Server  
on: [push, pull_request]  
  
jobs:  
  build:  
    runs-on: windows-latest  
    steps:  
      - name: 📥 Checkout Code  
        uses: actions/checkout@v4  
          
      - name: 📊 Build Status  
        run: echo "::notice title=Build Started::🚀 Starting OTX Server build process"  
          
      - name: 🚀 Cache Boost  
        uses: actions/cache@v4  
        id: cache-boost  
        with:  
          path: |  
            C:\ProgramData\chocolatey\lib\boost-msvc-14.3  
            C:\local\boost_1_84_0  
          key: boost-1.84.0-msvc-14.3-${{ runner.os }}  
            
      - name: 📦 Install Boost via Chocolatey  
        if: steps.cache-boost.outputs.cache-hit != 'true'  
        run: |  
          echo "::group::📦 Installing Boost"  
          choco install boost-msvc-14.3 --version=1.84.0 -y  
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }  
          if (!(Test-Path "C:\local\boost_1_84_0")) {  
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"  
          }  
          echo "::endgroup::"  
        shell: powershell  
          
      - name: 🔗 Create Boost symlink (if cached)  
        if: steps.cache-boost.outputs.cache-hit == 'true'  
        run: |  
          echo "::notice::📦 Using cached Boost libraries"  
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }  
          if (!(Test-Path "C:\local\boost_1_84_0")) {  
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"  
          }  
        shell: powershell  
            
      - name: 🗂️ Cache MSBuild objects  
        uses: actions/cache@v4  
        with:  
          path: |  
            sources/msvc/x64  
            sources/msvc/*.tlog  
          key: msbuild-cache-${{ runner.os }}-${{ hashFiles('sources/**/*.cpp', 'sources/**/*.h') }}  
          restore-keys: |  
            msbuild-cache-${{ runner.os }}-  
                
      - name: 🔧 Setup MSBuild  
        uses: microsoft/setup-msbuild@v2  
            
      - name: 🏗️ Build OTX Server  
        run: |  
          echo "::group::🏗️ Building OTX Server"  
          msbuild sources/msvc/TheOTXServer.vcxproj /p:Configuration=Release /p:Platform=x64 /m  
          echo "::endgroup::"  
        shell: powershell  
            
      - name: ⬆️ Upload Build Artifact  
        uses: actions/upload-artifact@v4  
        with:  
          name: 🎯-otx-server-build  
          path: sources/msvc/x64/Release/  
            
      - name: ✅ Build Success  
        if: success()  
        run: echo "::notice title=Success::🎉 OTX Server build completed successfully!"  
          
      - name: ❌ Build Failure  
        if: failure()  
        run: echo "::error title=Failed::💥 Build failed. Check the logs above for details."
