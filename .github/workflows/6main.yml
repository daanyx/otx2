name: ğŸ—ï¸ Build OTX Server  
on:   
  push:  
    branches: [ main, develop ]  
  pull_request:  
    branches: [ main ]  
  
jobs:  
  build:  
    name: ğŸ”¨ Build & Package  
    runs-on: windows-latest  
    strategy:  
      matrix:  
        configuration: [Release]  
        platform: [x64]  
      
    steps:  
      - name: ğŸ“¥ Checkout Repository  
        uses: actions/checkout@v4  
          
      - name: ğŸ’¾ Cache Boost Libraries  
        uses: actions/cache@v4  
        id: cache-boost  
        with:  
          path: |  
            C:\ProgramData\chocolatey\lib\boost-msvc-14.3  
            C:\local\boost_1_84_0  
          key: boost-1.84.0-msvc-14.3-choco-${{ runner.os }}  
            
      - name: ğŸ« Install Boost via Chocolatey  
        if: steps.cache-boost.outputs.cache-hit != 'true'  
        run: |  
          Write-Host "ğŸ”½ Instalando Boost 1.84.0..."  
          choco install boost-msvc-14.3 --version=1.84.0 -y  
            
          Write-Host "ğŸ“ Criando estrutura de diretÃ³rios..."  
          if (!(Test-Path "C:\local")) { New-Item -ItemType Directory -Path "C:\local" }  
          if (!(Test-Path "C:\local\boost_1_84_0")) {  
            New-Item -ItemType SymbolicLink -Path "C:\local\boost_1_84_0" -Target "C:\ProgramData\chocolatey\lib\boost-msvc-14.3\tools"  
          }  
          Write-Host "âœ… Boost instalado com sucesso!"  
        shell: powershell  
          
      - name: ğŸ” Verify Build Environment  
        run: |  
          Write-Host "ğŸ”§ === Build Environment Check ==="  
          Write-Host "ğŸ“¦ Boost Path: $(if (Test-Path 'C:\local\boost_1_84_0') { 'âœ… OK' } else { 'âŒ MISSING' })"  
          Write-Host "ğŸ“š Boost Libs: $(if (Test-Path 'C:\local\boost_1_84_0\lib64-msvc-14.3') { 'âœ… OK' } else { 'âŒ MISSING' })"  
          Write-Host "ğŸ› ï¸ MSBuild Version:"  
          msbuild -version  
          Write-Host "âœ¨ Environment ready!"  
        shell: powershell  
          
      - name: âš™ï¸ Setup MSBuild  
        uses: microsoft/setup-msbuild@v2  
          
      - name: ğŸš€ Build OTX Server  
        run: |  
          Write-Host "ğŸ”¨ Iniciando compilaÃ§Ã£o do OTX Server..."  
          msbuild sources/msvc/TheOTXServer.vcxproj `  
            /p:Configuration=${{ matrix.configuration }} `  
            /p:Platform=${{ matrix.platform }} `  
            /m `  
            /v:minimal `  
            /p:WarningLevel=1  
          Write-Host "ğŸ‰ CompilaÃ§Ã£o concluÃ­da com sucesso!"  
        shell: powershell  
          
      - name: ğŸ“¦ Upload Build Artifacts  
        uses: actions/upload-artifact@v4  
        with:  
          name: ğŸ¯ TheOTXServer-${{ matrix.configuration }}-${{ matrix.platform }}  
          path: |  
            sources/msvc/x64/Release/TheOTXServer.exe  
            sources/msvc/x64/Release/TheOTXServer.pdb  
          retention-days: 30  
  
      - name: ğŸ“Š Build Summary  
        if: success()  
        run: |  
          Write-Host "ğŸŠ === BUILD SUCCESSFUL ==="  
          Write-Host "ğŸ“ Artifact: TheOTXServer-${{ matrix.configuration }}-${{ matrix.platform }}"  
          Write-Host "ğŸ’¾ Size: $((Get-Item 'sources/msvc/x64/Release/TheOTXServer.exe').Length / 1MB) MB"  
          Write-Host "ğŸ•’ Build completed at: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"  
          Write-Host "âœ¨ Ready for deployment!"  
        shell: powershell
